

# Git 项目代码迁移流程（保留历史提交记录）
## 前言
在日常开发中，我们常需要将私有仓库的项目代码迁移到 GitHub 等开源平台，或因项目架构调整需要更换仓库地址。直接复制文件会丢失提交历史，因此需要使用 Git 的迁移方法来保留完整的版本历史记录。
本文总结了一种基于 git remote 和 git push 的迁移方案，适用于两个仓库之间迁移代码，并保留原有分支和提交记录。

## 迁移流程
### 1. 克隆目标仓库（B 项目）
如果本地还没有 B 项目的代码，先克隆下来：
```bash
git clone <B项目的仓库地址>
cd B项目
```
### 2. 添加源仓库（A 项目）为远程仓库
将 A 项目仓库添加为新的远程源，命名为 `a-repo`：
```bash
git remote add a-repo <A项目的仓库地址>
```
### 3. 获取 A 项目的分支信息
拉取 A 项目的所有分支和提交记录：
```bash
git fetch a-repo
```
### 4. 切换到目标分支（如 dev）
如果 B 项目已有 `dev` 分支，则切换到该分支：
```bash
git checkout dev
```
如果 `dev` 分支不存在，可以创建：
```bash
git checkout -b dev
```
### 5. 合并 A 项目的分支到当前分支
将 A 项目的 `dev` 分支合并到当前分支：
```bash
git merge a-repo/dev --allow-unrelated-histories
```
> **说明**：`--allow-unrelated-histories` 是因为两个仓库可能没有共同的提交历史。
### 6. 处理冲突（如有）
如果 B 项目之前已有提交记录，合并时可能会产生冲突。此时需手动解决冲突，并优先保留 A 项目的内容：
```bash
git diff --name-only --diff-filter=U | while read file; do
    git checkout --theirs "$file"
    git add "$file"
done
```
### 7. 提交并推送到 B 项目的远程仓库
完成冲突处理后，提交更改并推送到 B 项目的远程分支：
```bash
git commit -m "Merge code from A repo"
git push origin dev
```
---
## 注意事项
- **分支一致性**：确保 A 项目和 B 项目的分支名称一致，如 `dev`、`main` 等。
- **冲突处理**：合并时如遇冲突，建议优先保留源仓库（A 项目）的代码，除非有特殊需求。
- **权限检查**：确保你有权限向 B 项目仓库推送代码。
- **多分支迁移**：如需迁移多个分支，需重复执行步骤 4-7，切换到不同分支进行合并和推送。
---
## 最佳实践
- **备份原仓库**：在执行迁移前，建议先备份 A 项目和 B 项目的代码。
- **测试环境验证**：在测试环境中先进行迁移流程验证，确保无遗漏或错误。
- **团队沟通**：迁移前通知团队成员，避免在迁移过程中产生新的提交导致冲突。
---

