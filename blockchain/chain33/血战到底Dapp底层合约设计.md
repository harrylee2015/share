# 血战到底Dapp底层合约设计

## 游戏规则

* 游戏发起人可以创建房间，最多创建5个房间，每个房间不限次数，开始掷骰子

* 获得点数 1 * 1 的玩家，按次数平分奖池的70%奖金

* 其他规则待补充


## 合约设计

### 实现方式

* 采用EVM方式去实现

### 问题点

 ***seed随机源取值问题，必须要实现不可预测，在拉取多条链的情况下，获取的随机数必须要一样，避免分叉***
 
 目前备选两种方案：
 
 **方案一：**
 
 seed随机源取交易的时间，所在打包的块的时间,加index进行取模操作，后在1到6进行区间整数的映射
 
 ***优点：***
 
    随机数是在链上生成的，只有被打包后，才会具体知道生成的结果。
    
    除非作恶者控制打包节点，不然很难提前预测到随机结果
    
 ***缺点：***
 
    这种方案其实并不是真正意义上面的随机取值。
    
    其次会存在区块回滚的情况，如果一回滚的话，因为随机因子可能发生改变，因此产生的随机数也会发生改变
 
 
 **方案二：**
 
  提供rpc接口创建交易的时候，就利用rand伪随机函数生成好随机数，这种方案需要对生成好的随机数进行动态加密  
  
   ***优点：***
   
   交易生成的时候随机数就已经是固定好的，不用担心回滚问题
    
   ***缺点：***
 
    需要提前将密钥写到链上，并且需要对合约中密钥查询接口设置ACL，时间访问控制设限制，必须要在开奖交易打包后再放开查询权限
    
    即使这样，如果私钥由外部传入的话，仍然会存在被拦截被解析的风险

 **方案三：**
   
   方案一和方案二的综合版本，方案二的密钥采用方案一的seed随机源进行内部生成密钥，这样在开奖交易之前，谁都不会知道密钥
