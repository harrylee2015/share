# 初识 frabic

## 前言介绍
一般而言，区块链是不可变的事务分类账，维护在对等节点的分布式网络中。这些节点通过应用已经由共识协议验证的事务来维护分类帐的副本，该事务被分组为包括将每个块绑定到前一个块的散列的块。

区块链的第一个也是最广为人知的应用是 比特币加密货币，尽管其他人跟随它的脚步。以太币是另一种加密货币，采用了不同的方法，集成了许多与比特币相同的特性，但增加了智能合约，为分布式应用创建了一个平台。比特币和以太坊属于一类区块链，我们将其归类为 公共许可区块链技术。基本上，这些是公共网络，对所有人开放，参与者匿名互动。

随着比特币，以太坊和其他一些衍生技术的普及，对将区块链，分布式账本和分布式应用平台的基础技术应用于更具创新性的企业用例的兴趣 也在增长。但是，许多企业用例需要无权区块链技术无法（目前）交付的性能特征。此外，在许多使用案例中，参与者的身份是一项硬性要求，例如在必须遵循“了解客户”（KYC）和反洗钱（AML）法规的金融交易中。

对于企业用途，我们需要考虑以下要求：

必须识别/识别参与者
网络需要获得许可
高事务吞吐量性能
交易确认的低延迟
与商业交易有关的交易和数据的隐私和机密性
虽然许多早期的区块链平台目前正在适合企业使用，但Hyperledger Fabric 从一开始就被设计用于企业用途。以下部分描述了Hyperledger Fabric（Fabric）如何将自己与其他区块链平台区分开来，并描述了其架构决策的一些动机。

## Hyperledger fabric
Hyperledger Fabric是一种开源的企业级许可分布式分类帐技术（DLT）平台，专为在企业环境中使用而设计，与其他流行的分布式分类帐或区块链平台相比，它提供了一些关键的差异化功能。

差异化的一个关键点是Hyperledger是在Linux基金会下建立的，该基金会本身在开放式治理下培育开源项目的历史悠久且非常成功，这些项目可以发展强大的持续社区和蓬勃发展的生态系统。Hyperledger由多元化技术指导委员会和Hyperledger Fabric项目管理，该项目由来自多个组织的各种维护人员组成。它拥有一个开发社区，自最早提交以来已经发展到超过35个组织和近200个开发人员。

Fabric具有高度模块化和可配置的架构，支持创新，多功能性和优化，适用于广泛的行业用例，包括银行，金融，保险，医疗保健，人力资源，供应链甚至数字音乐交付。

Fabric是第一个支持在通用编程语言（如Java，Go和Node.js）中创建的智能合约的分布式账本平台，而不是受限制的特定于域的语言（DSL）。这意味着大多数企业已经具备开发智能合约所需的技能，并且不需要额外的培训来学习新的语言或DSL。

Fabric平台也获得了许可，这意味着，与公共无权网络不同，参与者彼此了解，而不是匿名，因此完全不受信任。这意味着，尽管参与者可能不会完全信任彼此（它们可能，例如，在同行业竞争对手），网络可以说是建立关闭的治理模式下操作了什么信任并不参与者之间存在，如处理纠纷的法律协议或框架。

该平台最重要的区别之一是它支持 可插拔的共识协议，使平台能够更有效地进行定制，以适应特定的用例和信任模型。例如，当部署在单个企业内或由可信任的权威机构运营时，完全拜占庭容错的共识可能被认为是不必要的，并且对性能和吞吐量造成过度拖累。在诸如此类的情况下， 崩溃容错（CFT）共识协议可能绰绰有余，而在多方分散用例中， 可能需要更传统的 拜占庭容错（BFT）共识协议。

Fabric可以利用不需要本机加密货币的共识协议来激活昂贵的采矿或推动智能合约执行。避免加密货币会减少一些重要的风险/攻击向量，并且缺少加密挖掘操作意味着可以使用与任何其他分布式系统大致相同的运营成本来部署平台。

这些差异化设计特性的结合使Fabric成为当今业务处理和事务确认延迟方面性能更好的平台之一，它实现了事务的隐私和机密性以及实现的智能合约（Fabric称之为“链代码”）他们。

让我们更详细地探索这些差异化的功能。

## 模块化
Hyperledger Fabric经过专门设计，具有模块化架构。无论是可插拔的共识，可插拔的身份管理协议（如LDAP或OpenID Connect），密钥管理协议还是加密库，该平台的核心都经过精心设计，以满足企业用例需求的多样性。

在高层次上，Fabric由以下模块化组件组成：

* 可插拔订购服务就交易顺序建立共识，然后向对等方广播块。
* 可插入的成员资格服务提供者负责将网络中的实体与加密身份相关联。
* 可选的对等八卦服务通过向其他对等方订购服务来传播块输出。
* 智能合约（“chaincode”）在容器环境（例如Docker）内运行以进行隔离。它们可以用标准编程语言编写，但不能直接访问分类帐状态。
* 分类帐可以配置为支持各种DBMS。
* 可插拔的认可和验证策略实施，可根据应用程序独立配置。

业界公平地认为，没有“一个区块链可以统治所有人”。Hyperledger Fabric可以通过多种方式进行配置，以满足多个行业用例的各种解决方案要求。

## Permissioned vs Permissionless Blockchains（许可vs 未许可区块链）
在一个免授权的区块链中，几乎任何人都可以参与，每个参与者都是匿名的。在这样的上下文中，除了在某个深度之前区块链的状态是不可变的之外，不存在任何信任。为了减轻这种信任的缺失，无权限的区块链通常采用“挖掘”的本地加密货币或交易费用来提供经济激励，以抵消参与基于“工作证明”的拜占庭容错共识形式的特殊成本（PoW） ）。

另一方面，许可的区块链在一组已知的，已识别的且经常经过审查的参与者中操作区块链，这些参与者在一种产生一定程度信任的治理模型下运作。许可的区块链提供了一种方法来保护具有共同目标但可能彼此不完全信任的一组实体之间的交互。通过依赖参与者的身份，许可的区块链可以使用更传统的崩溃容错（CFT）或拜占庭容错（BFT）共识协议，这些协议不需要昂贵的挖掘。

另外，在这种许可的上下文中，参与者通过智能合约故意引入恶意代码的风险降低。首先，参与者彼此了解并且所有动作，无论是提交应用程序事务，修改网络配置还是部署智能合约，都按照为网络和相关交易类型建立的认可策略记录在区块链上。可以很容易地识别有罪方，而不是完全匿名，并根据治理模式的条款处理事件。

## 智能合约
智能合约或Fabric称之为“链代码”，作为受信任的分布式应用程序，从区块链获得其安全性/信任以及同行之间的基本共识。它是区块链应用程序的业务逻辑。

有三个关键点适用于智能合约，尤其是应用于平台时：

许多智能合约在网络中同时运行，
它们可以动态部署（在很多情况下是任何人），以及
应用程序代码应视为不受信任，甚至可能是恶意的。
大多数现有的具有智能合约能力的区块链平台遵循 订单执行架构，其中共识协议：

验证并订购事务然后将它们传播到所有对等节点，
然后，每个对等体顺序执行事务。
几乎所有现有的区块链系统都可以找到订单执行架构，范围从公共/ 无权平台，如 以太坊（基于PoW的共识）到许可平台，如Tendermint， Chain和Quorum。

在区块链中执行的与订单执行架构一起运行的智能合约必须是确定性的; 否则，可能永远不会达成共识。为了解决非确定性问题，许多平台要求智能合约以非标准或特定于域的语言（例如Solidity）编写，以便可以消除非确定性操作。这阻碍了广泛采用，因为它要求开发人员编写智能合同以学习新语言并可能导致编程错误。

此外，由于所有节点都顺序执行所有事务，因此性能和规模有限。智能合约代码在系统中的每个节点上执行的事实要求采取复杂措施来保护整个系统免受潜在恶意合同的影响，以确保整个系统的弹性。

## 一种新方法
Fabric为我们称为execute-order-validate的事务引入了一种新的体系结构 。它通过将事务流分为三个步骤来解决订单执行模型面临的弹性，灵活性，可伸缩性，性能和机密性挑战：

执行一个事务并检查其正确性，从而认可它，
通过（可插入的）共识协议订购交易，以及
在将提交到分类帐之前，根据特定于应用程序的认可策略验证事务
这种设计与订单执行范例完全不同，因为Fabric在达成订单的最终协议之前执行交易。

在Fabric中，特定于应用程序的认可策略指定哪些对等节点或多少对等节点需要保证正确执行给定的智能合约。因此，每个事务只需要由满足事务的认可策略所必需的对等节点的子集来执行（认可）。这允许并行执行，从而提高系统的整体性能和规模。第一阶段也消除了任何非确定性，因为在排序之前可以滤除不一致的结果。

因为我们已经消除了非确定性，所以Fabric是第一个能够使用标准编程语言的区块链技术。在1.1.0版本中，智能合约可以用Go或Node.js编写，而有计划在后续版本中支持其他流行语言，包括Java。

## 隐私和保密
正如我们所讨论的，在一个公共的，无权限的区块链网络中，利用PoW作为其共识模型，事务在每个节点上执行。这意味着合同本身和他们处理的交易数据都不存在机密性。每个事务以及实现它的代码对于网络中的每个节点都是可见的。在这种情况下，我们交易了PoW提供的拜占庭容错共识的合同和数据的机密性。

对于许多企业/企业用例而言，这种缺乏机密性可能会有问题。例如，在供应链合作伙伴网络中，某些消费者可能会获得优惠利率，作为巩固关系或促进额外销售的手段。如果每个参与者都可以看到每个合同和交易，那么就无法在完全透明的网络中维持这种业务关系 - 每个人都希望获得优惠费率！

作为第二个例子，考虑证券行业，建立头寸（或处置一个）的交易者不希望她的竞争对手知道这一点，否则他们将寻求进入游戏，削弱交易者的策略。

为了解决为实现企业用例要求而缺乏隐私和机密性，区块链平台采用了多种方法。所有人都有自己的权衡。

加密数据是提供机密性的一种方法; 然而，在利用PoW达成共识的无权网络中，加密数据位于每个节点上。如果有足够的时间和计算资源，加密可能会被打破。对于许多企业用例，其信息可能受到损害的风险是不可接受的。

零知识证明（ZKP）是正在探索解决该问题的另一个研究领域，这里的权衡是，目前，计算ZKP需要相当多的时间和计算资源。因此，在这种情况下的权衡是保密性。

在可以利用其他形式的共识的许可上下文中，可以探索限制机密信息仅限于授权节点的方法。

Hyperledger Fabric是一个经过许可的平台，通过其通道架构实现机密性。基本上，Fabric网络上的参与者可以在参与者子集之间建立“通道”，该通道应该被授予对特定事务集的可见性。将此视为网络覆盖。因此，只有参与频道的节点才能访问智能合约（链代码）和数据交易，从而保护两者的隐私和机密性。

为了提高其隐私和机密性能，Fabric增加了对私有数据的支持，并且正在开发未来可用的零知识证明（ZKP）。更多关于这一点，因为它变得可用。

## 可插入的共识
事务的排序被委托给模块化组件以达成共识，该组件在逻辑上与执行事务和维护分类帐的对等体分离。具体来说，订购服务。由于共识是模块化的，因此可以根据特定部署或解决方案的信任假设来定制其实现。这种模块化架构允许平台依赖完善的工具包进行CFT（崩溃容错）或BFT（拜占庭容错）排序。

在当前可用的版本中，Fabric提供了使用Kafka和 Zookeeper实现的CFT订购服务。在随后的版本中，Fabric将提供使用etcd / Raft 实现的Raft共识订购服务以及完全分散的BFT订购服务。

另请注意，这些并不相互排斥。Fabric网络可以具有多种订购服务，支持不同的应用或应用要求。

性能和可伸缩性
区块链平台的性能可能会受到许多变量的影响，例如事务大小，块大小，网络大小以及硬件限制等.Hyperledger社区目前正在开发性能和规模工作组中的一组度量标准，以及称为Hyperledger Caliper的基准测试框架的相应实现 。

虽然这项工作仍在继续开发，应该被视为区块链平台性能和规模特征的明确衡量标准，但IBM Research的一个团队发表了一份 同行评审文章，评估了Hyperledger Fabric的架构和性能。本文提供了对Fabric架构的深入讨论，然后使用Hyperledger Fabric v1.1的初步版本报告团队对平台的性能评估。

研究团队所做的基准测试工作为Fabric v1.1.0版本带来了大量的性能改进，从v1.0.0版本级别将平台的整体性能提高了一倍以上。

结论
对区块链平台的任何认真评估都应该在其短名单中包含Hyperledger Fabric。

结合，Fabric的差异化功能使其成为一个高度可扩展的系统，用于支持灵活的信任假设的许可区块链，使平台能够支持从政府，金融，供应链物流到医疗保健等各种行业用例。多得多。

更重要的是，Hyperledger Fabric是（目前）十个Hyperledger项目中最活跃的。围绕平台的社区建设正在稳步增长，每个连续版本提供的创新远远超过任何其他企业区块链平台。
